<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Desafio Técnico Port Louis</title>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.5.11/dist/vuetify.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/vuetify@3.5.11/dist/vuetify.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css"
      rel="stylesheet"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Sigmar+One&display=swap"
      rel="stylesheet"
    />

    <style>
      #app {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <v-app theme="dark">
        <v-app-bar flat class="border-b" title="Port Louis">
          <v-dialog max-width="600" v-model="dialog">
            <template v-slot:activator="{ props: activatorProps }">
              <v-btn v-bind="activatorProps" icon="mdi-plus"></v-btn>
            </template>
            <v-card prepend-icon="mdi-account" title="Adicionar Usuário">
              <v-card-text>
                <v-row dense>
                  <v-col>
                    <v-text-field
                      variant="underlined"
                      :color="validaNome() ? '' : 'red-darken-1'"
                      :hint="validaNome() ? '' : 'Mínimo de 2 palavras de 3 letras cada'"
                      prepend-icon="mdi-star"
                      label="Nome"
                      v-model="nome"
                      required
                      :rules="validaNome"
                    ></v-text-field>
                  </v-col>
                  <v-col>
                    <v-text-field
                      variant="underlined"
                      :color="validaTelefone() ? '' : 'red-darken-1'"
                      :hint="validaTelefone() ? '' : 'Formato de telefone inválido. Use (xx) xxxx-xxxx'"
                      prepend-icon="mdi-paperclip"
                      label="Telefone"
                      v-model="telefone"
                      required
                      :rules="validaTelefone"
                    ></v-text-field>
                  </v-col>
                </v-row>
              </v-card-text>
              <v-divider></v-divider>
              <v-card-actions>
                <v-spacer></v-spacer>
                <v-btn
                  color="red-darken-1"
                  text="fechar"
                  variant="tonal"
                  @click="dialog = false"
                ></v-btn>
                <v-btn
                  color="indigo-lighten-3"
                  text="salvar"
                  variant="tonal"
                  :disabled="!validaNome() || !validaTelefone()"
                  @click="salvarContato"
                ></v-btn>
              </v-card-actions>
            </v-card>
          </v-dialog>
        </v-app-bar>
        <v-main>
          <v-container>
            <div class="d-flex justify-center">CONTATOS</div>
            <v-divider></v-divider>
            <v-data-table
              :items="contatos"
              :item-key="nome"
              :headers="headers"
            >
            <template v-slot:item.acao="{ item }">
              <v-icon class="me-2" size="small" @click="editarContato(item)">mdi-pencil</v-icon>
              <v-icon size="small" @click="deletarContato(item)">mdi-delete</v-icon>
            </template>
            </v-data-table>
          </v-container>
        </v-main>
      </v-app>
    </div>
  </body>
  <script>
    const { createApp, ref } = Vue;
    const { createVuetify } = Vuetify;

    const vuetify = createVuetify();

    createApp({
      setup() {
        const dialog = ref(false);
        const nome = ref("");
        const telefone = ref("");

        const headers = [
          {
            title: "Nome",
            align: "start",
            key: "nome"
          },
          {
            title: "Telefone",
            key: "telefone"
          },
          {
            title: "",
            key: "acao",
            sortable: false
          }
        ]

        const contatos = ref([
          {
            nome: "Carlos Mesquita",
            telefone: "(11) 8230-3693",
          },
          {
            nome: "John Doe",
            telefone: "(91) 8755-7027",
          },
          {
            nome: "Clara Silva",
            telefone: "(95) 9234-5966",
          },
        ]);


        const validaNome = () => {
          const palavra = nome.value.trim().split(" ");
          if (palavra.length < 2 || palavra.some((word) => word.length < 3)) {
            return false;
          }
          return true;
        };

        const validaTelefone = () => {
          const telefoneRegex = /^\(\d{2}\) \d{4}-\d{4}$/;
          if (!telefoneRegex.test(telefone.value)) {
            return false;
          }
          return true;
        };

        const salvarContato = () => {
          if (validaNome() && validaTelefone()) {
            contatos.push({
              nome: nome._value,
              telefone: telefone._value
            })
            dialog = false;
            nome.value = "";
            telefone.value = "";
          }
        };

        const editarContato = (item) => {
          this.editedIndex = this.contatos.idexOf(item)
          this.editedItem = Object.assign({}, item)
          this.dialog = true
        }

        const deletarContato = (item) => {
          this.editedIndex = this.contatos.indexOf(item)
          this.editedItem = Object.assign({}, item)
          this.dialogDelete = true
        }

        // const checkDDD = (row) => {
        //   return row.telefone.includes("(11)");
        // };

        return {
          dialog,
          nome,
          telefone,
          salvarContato,
          validaTelefone,
          validaNome,
          // checkDDD,
          editarContato,
          deletarContato,
          contatos,
          headers,
          editarContato,
          deletarContato
        };
      },
    })
      .use(vuetify)
      .mount("#app");
  </script>

  <style scoped>
    .blue-row {
      background-color: lightblue !important;
    }
  </style>
</html>
